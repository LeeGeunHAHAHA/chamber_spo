#!/bin/bash
source ../common
GROUP_TITLE="multi-thread mixed operation test(8 namespaces without 512B)"
TITLE='OPER=$OPERATION SLBA=$SLBA SIZE=4KB:$IOSIZE_4KB'
DEALLOC_MICRO_RANGE=256MB
DEALLOC_FW_RANGE=1024MB

if [[ -n $DYNAMIC_AMOUNT ]]; then
	export AMOUNT=$DYNAMIC_AMOUNT
fi

group_init $@

run_config
PARAM_FILE=parameter_ns8
OPERATION="read:20,write:80" SLBA=uniform IOSIZE_4KB=4096  run_test
OPERATION="read:20,write:80" SLBA=uniform IOSIZE_4KB=$MDTS  run_test
OPERATION="read:20,write:80" SLBA=uniform IOSIZE_4KB=4096-$MDTS  run_test
OPERATION="read:20,write:80" SLBA=zipf IOSIZE_4KB=4096  run_test
OPERATION="read:20,write:80" SLBA=zipf IOSIZE_4KB=$MDTS  run_test
OPERATION="read:20,write:80" SLBA=zipf IOSIZE_4KB=4096-$MDTS run_test

PARAM_FILE=parameter_ns8_de
OPERATION="read:20,write:78,dealloc:2" SLBA=uniform IOSIZE_4KB=4096 DEALLOC_SIZE_4KB=4KB-$DEALLOC_MICRO_RANGE  run_test
OPERATION="read:20,write:75,dealloc:5" SLBA=uniform IOSIZE_4KB=$MDTS  DEALLOC_SIZE_4KB=$DEALLOC_MICRO_RANGE-$DEALLOC_FW_RANGE  run_test
OPERATION="read:20,write:70,dealloc:10" SLBA=uniform IOSIZE_4KB=4096-$MDTS  DEALLOC_SIZE_4KB=4KB-$DEALLOC_FW_RANGE  run_test
OPERATION="read:20,write:78,dealloc:2" SLBA=zipf IOSIZE_4KB=4096 DEALLOC_SIZE_4KB=4KB-$DEALLOC_MICRO_RANGE  run_test
OPERATION="read:20,write:75,dealloc:5" SLBA=zipf IOSIZE_4KB=$MDTS  DEALLOC_SIZE_4KB=$DEALLOC_MICRO_RANGE-$DEALLOC_FW_RANGE  run_test
OPERATION="read:20,write:70,dealloc:10" SLBA=zipf IOSIZE_4KB=4096-$MDTS  DEALLOC_SIZE_4KB=4KB-$DEALLOC_FW_RANGE  run_test

PARAM_FILE=parameter_ns8
OPERATION="read:20,write:78,write_zeroes:2" SLBA=uniform IOSIZE_4KB=4096  run_test
OPERATION="read:20,write:75,write_zeroes:5" SLBA=uniform IOSIZE_4KB=$MDTS  run_test
OPERATION="read:20,write:70,write_zeroes:10" SLBA=uniform IOSIZE_4KB=4096-$MDTS  run_test
OPERATION="read:20,write:78,write_zeroes:2" SLBA=zipf IOSIZE_4KB=4096  run_test
OPERATION="read:20,write:75,write_zeroes:5" SLBA=zipf IOSIZE_4KB=$MDTS  run_test
OPERATION="read:20,write:70,write_zeroes:10" SLBA=zipf IOSIZE_4KB=4096-$MDTS  run_test

PARAM_FILE=parameter_ns8
OPERATION="read:20,write:78,write_uncor:2" SLBA=uniform IOSIZE_4KB=4096  run_test
OPERATION="read:20,write:75,write_uncor:5" SLBA=uniform IOSIZE_4KB=$MDTS  run_test
OPERATION="read:20,write:70,write_uncor:10" SLBA=uniform IOSIZE_4KB=4096-$MDTS  run_test
OPERATION="read:20,write:78,write_uncor:2" SLBA=zipf IOSIZE_4KB=4096  run_test
OPERATION="read:20,write:75,write_uncor:5" SLBA=zipf IOSIZE_4KB=$MDTS  run_test
OPERATION="read:20,write:70,write_uncor:10" SLBA=zipf IOSIZE_4KB=4096-$MDTS  run_test

PARAM_FILE=parameter_ns8_de
OPERATION="R:20,W:50,D:10,WZ:10,WU:10" SLBA=uniform IOSIZE_4KB=4096  DEALLOC_SIZE_4KB=4KB-$DEALLOC_FW_RANGE  run_test
OPERATION="R:20,W:50,D:10,WZ:10,WU:10" SLBA=uniform IOSIZE_4KB=$MDTS  DEALLOC_SIZE_4KB=4KB-$DEALLOC_FW_RANGE  run_test
OPERATION="R:20,W:50,D:10,WZ:10,WU:10" SLBA=uniform IOSIZE_4KB=4096-$MDTS  DEALLOC_SIZE_4KB=4KB-$DEALLOC_FW_RANGE  run_test
OPERATION="R:20,W:50,D:26,WZ:2,WU:2" SLBA=uniform IOSIZE_4KB=4096-$MDTS  DEALLOC_SIZE_4KB=4KB-$DEALLOC_FW_RANGE run_test
OPERATION="R:20,W:50,D:2,WZ:26,WU:2" SLBA=uniform IOSIZE_4KB=4096-$MDTS  DEALLOC_SIZE_4KB=4KB-$DEALLOC_FW_RANGE run_test
OPERATION="R:20,W:50,D:2,WZ:2,WU:26" SLBA=uniform IOSIZE_4KB=4096-$MDTS  DEALLOC_SIZE_4KB=4KB-$DEALLOC_FW_RANGE run_test
OPERATION="R:20,W:50,D:10,WZ:10,WU:10" SLBA=zipf IOSIZE_4KB=4096  DEALLOC_SIZE_4KB=4KB-$DEALLOC_FW_RANGE  run_test
OPERATION="R:20,W:50,D:10,WZ:10,WU:10" SLBA=zipf IOSIZE_4KB=$MDTS DEALLOC_SIZE_4KB=4KB-$DEALLOC_FW_RANGE  run_test
OPERATION="R:20,W:50,D:10,WZ:10,WU:10" SLBA=zipf IOSIZE_4KB=4096-$MDTS  DEALLOC_SIZE_4KB=4KB-$DEALLOC_FW_RANGE  run_test
OPERATION="R:20,W:50,D:26,WZ:2,WU:2" SLBA=zipf IOSIZE_4KB=4096-$MDTS  DEALLOC_SIZE_4KB=4KB-$DEALLOC_FW_RANGE  run_test
OPERATION="R:20,W:50,D:2,WZ:26,WU:2" SLBA=zipf IOSIZE_4KB=4096-$MDTS  DEALLOC_SIZE_4KB=4KB-$DEALLOC_FW_RANGE  run_test
OPERATION="R:20,W:50,D:2,WZ:2,WU:26" SLBA=zipf IOSIZE_4KB=4096-$MDTS  DEALLOC_SIZE_4KB=4KB-$DEALLOC_FW_RANGE  run_test

PARAM_FILE=parameter_ns8
OPERATION="read:80,write:20" SLBA=uniform IOSIZE_4KB=4096  run_test
OPERATION="read:80,write:20" SLBA=uniform IOSIZE_4KB=$MDTS  run_test
OPERATION="read:80,write:20" SLBA=uniform IOSIZE_4KB=4096-$MDTS  run_test
OPERATION="read:80,write:20" SLBA=zipf IOSIZE_4KB=4096  run_test
OPERATION="read:80,write:20" SLBA=zipf IOSIZE_4KB=$MDTS  run_test
OPERATION="read:80,write:20" SLBA=zipf IOSIZE_4KB=4096-$MDTS  run_test
