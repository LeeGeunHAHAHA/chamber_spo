#!/bin/bash
source ../common
GROUP_TITLE="multi-thread mixed operation test"
TITLE='OPER=$OPERATION SLBA=$SLBA SIZE=$IOSIZE'

if [[ -n $DYNAMIC_AMOUNT ]]; then
	export AMOUNT=$DYNAMIC_AMOUNT
fi

group_init $@

IOSIZE_MIN=$NAMESPACE_BSZ
IOSIZE_MAX=$MDTS
DEALLOC_MICRO_RANGE=256MB
DEALLOC_FW_RANGE=1024MB

run_config
PARAM_FILE=parameter
OPERATION="read:20,write:80" SLBA=uniform IOSIZE=$IOSIZE_MIN run_test
OPERATION="read:20,write:80" SLBA=uniform IOSIZE=$IOSIZE_MAX run_test
OPERATION="read:20,write:80" SLBA=uniform IOSIZE=$IOSIZE_MIN-$IOSIZE_MAX run_test
OPERATION="read:20,write:80" SLBA=zipf IOSIZE=$IOSIZE_MIN run_test
OPERATION="read:20,write:80" SLBA=zipf IOSIZE=$IOSIZE_MAX run_test
OPERATION="read:20,write:80" SLBA=zipf IOSIZE=$IOSIZE_MIN-$IOSIZE_MAX run_test

PARAM_FILE=parameter_de
OPERATION="read:20,write:78,dealloc:2" SLBA=uniform IOSIZE=$IOSIZE_MIN DEALLOC_SIZE=$IOSIZE_MIN-$DEALLOC_MICRO_RANGE run_test
OPERATION="read:20,write:75,dealloc:5" SLBA=uniform IOSIZE=$IOSIZE_MAX DEALLOC_SIZE=$DEALLOC_MICRO_RANGE-$DEALLOC_FW_RANGE run_test
OPERATION="read:20,write:70,dealloc:10" SLBA=uniform IOSIZE=$IOSIZE_MIN-$IOSIZE_MAX DEALLOC_SIZE=$IOSIZE_MIN-$DEALLOC_FW_RANGE run_test
OPERATION="read:20,write:78,dealloc:2" SLBA=zipf IOSIZE=$IOSIZE_MIN DEALLOC_SIZE=$IOSIZE_MIN-$DEALLOC_MICRO_RANGE run_test
OPERATION="read:20,write:75,dealloc:5" SLBA=zipf IOSIZE=$IOSIZE_MAX DEALLOC_SIZE=$DEALLOC_MICRO_RANGE-$DEALLOC_FW_RANGE run_test
OPERATION="read:20,write:70,dealloc:10" SLBA=zipf IOSIZE=$IOSIZE_MIN-$IOSIZE_MAX DEALLOC_SIZE=$IOSIZE_MIN-$DEALLOC_FW_RANGE run_test

PARAM_FILE=parameter
OPERATION="read:20,write:78,write_zeroes:2" SLBA=uniform IOSIZE=$IOSIZE_MIN run_test
OPERATION="read:20,write:75,write_zeroes:5" SLBA=uniform IOSIZE=$IOSIZE_MAX run_test
OPERATION="read:20,write:70,write_zeroes:10" SLBA=uniform IOSIZE=$IOSIZE_MIN-$IOSIZE_MAX run_test
OPERATION="read:20,write:78,write_zeroes:2" SLBA=zipf IOSIZE=$IOSIZE_MIN run_test
OPERATION="read:20,write:75,write_zeroes:5" SLBA=zipf IOSIZE=$IOSIZE_MAX run_test
OPERATION="read:20,write:70,write_zeroes:10" SLBA=zipf IOSIZE=$IOSIZE_MIN-$IOSIZE_MAX run_test

PARAM_FILE=parameter_de
OPERATION="R:20,W:50,D:15,WZ:15" SLBA=uniform IOSIZE=$IOSIZE_MIN DEALLOC_SIZE=$IOSIZE_MIN-$DEALLOC_FW_RANGE run_test
OPERATION="R:20,W:50,D:15,WZ:15" SLBA=uniform IOSIZE=$IOSIZE_MAX DEALLOC_SIZE=$IOSIZE_MIN-$DEALLOC_FW_RANGE run_test
OPERATION="R:20,W:50,D:28,WZ:2" SLBA=uniform IOSIZE=$IOSIZE_MIN-$IOSIZE_MAX DEALLOC_SIZE=$IOSIZE_MIN-$DEALLOC_FW_RANGE run_test
OPERATION="R:20,W:50,D:2,WZ:28" SLBA=uniform IOSIZE=$IOSIZE_MIN-$IOSIZE_MAX DEALLOC_SIZE=$IOSIZE_MIN-$DEALLOC_FW_RANGE run_test

OPERATION="R:20,W:50,D:15,WZ:15" SLBA=zipf IOSIZE=$IOSIZE_MIN DEALLOC_SIZE=$IOSIZE_MIN-$DEALLOC_FW_RANGE run_test
OPERATION="R:20,W:50,D:15,WZ:15" SLBA=zipf IOSIZE=$IOSIZE_MAX DEALLOC_SIZE=$IOSIZE_MIN-$DEALLOC_FW_RANGE run_test
OPERATION="R:20,W:50,D:28,WZ:2" SLBA=zipf IOSIZE=$IOSIZE_MIN-$IOSIZE_MAX DEALLOC_SIZE=$IOSIZE_MIN-$DEALLOC_FW_RANGE run_test
OPERATION="R:20,W:50,D:2,WZ:28" SLBA=zipf IOSIZE=$IOSIZE_MIN-$IOSIZE_MAX DEALLOC_SIZE=$IOSIZE_MIN-$DEALLOC_FW_RANGE run_test

PARAM_FILE=parameter
OPERATION="read:80,write:20" SLBA=uniform IOSIZE=$IOSIZE_MIN run_test
OPERATION="read:80,write:20" SLBA=uniform IOSIZE=$IOSIZE_MAX run_test
OPERATION="read:80,write:20" SLBA=uniform IOSIZE=$IOSIZE_MIN-$IOSIZE_MAX run_test
OPERATION="read:80,write:20" SLBA=zipf IOSIZE=$IOSIZE_MIN run_test
OPERATION="read:80,write:20" SLBA=zipf IOSIZE=$IOSIZE_MAX run_test
OPERATION="read:80,write:20" SLBA=zipf IOSIZE=$IOSIZE_MIN-$IOSIZE_MAX run_test

PARAM_FILE=jfs_parameter TITLE="journaling filesystem modeling" run_test
