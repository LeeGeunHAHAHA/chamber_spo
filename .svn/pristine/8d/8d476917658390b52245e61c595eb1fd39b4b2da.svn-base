#!/usr/bin/env bash
source ../common > /dev/null 2>&1

init

# enable all asynchronous events
nvme set-feature $FQA_DEVICE -f 11 -v 0xffff

# clear smart/health status event
nvme smart-log $FQA_DEVICE > /dev/null
check_aerc

# raise smart/health warning aer
nvme set-feature $FQA_DEVICE -f 4 -v 0
check_aerc

# critical warning(temperature threshold exceed) set
nvme smart-log $FQA_DEVICE | grep crit
check_aerc

nvme set-feature $FQA_DEVICE -f 4 -v 353
check_aerc

# no critical warning
nvme smart-log $FQA_DEVICE | grep crit
check_aerc

# raise smart/health warning aer
nvme set-feature $FQA_DEVICE -f 4 -v 0
check_aerc

# critical warning(temperature threshold exceed) set
nvme smart-log $FQA_DEVICE | grep crit
check_aerc

nvme set-feature $FQA_DEVICE -f 4 -v 353
check_aerc

# no critical warning
nvme smart-log $FQA_DEVICE | grep crit
check_aerc

